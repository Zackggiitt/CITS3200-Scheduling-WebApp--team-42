<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schedule Manager</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
  <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
  <!-- Topbar -->
  <header class="admin-topbar">
    <div class="admin-topbar__container">
      <div class="admin-topbar__left">
        <span class="material-icons admin-topbar__logo" aria-hidden="true">event</span>
        <span class="admin-topbar__title">Schedule Manager</span>
      </div>
      <div class="admin-topbar__right">
        <button class="admin-topbar__icon-btn" type="button" aria-label="Notifications" id="adminNotifBtn">
          <span class="material-icons" aria-hidden="true">notifications</span>
          {% if pending_swaps and pending_swaps > 0 %}
            <span class="notif-badge">{{ pending_swaps }}</span>
          {% else %}
            <span class="notif-badge">1</span>
          {% endif %}
        </button>
        <div class="admin-topbar__user" aria-label="Current user">
          <span class="material-icons" aria-hidden="true">person</span>
          <span class="admin-topbar__name">{{ user.full_name if user else 'Admin User' }}</span>
        </div>
        <span class="role-chip role-chip--admin">System Admin</span>
        <form method="POST" action="{{ url_for('auth.logout') }}" class="logout-form" style="display: inline;">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <button type="submit" class="logout-btn">
            <span class="material-icons" aria-hidden="true">logout</span>
            <span>Logout</span>
          </button>
        </form>
      </div>
    </div>
  </header>

  <!-- You can add admin content below -->
  <main class="container" style="max-width:1200px;margin:24px auto;padding:0 16px;">
    <h2 style="font-family: 'Roboto', sans-serif; font-weight: 600;">Admin Dashboard</h2>
    
    <!-- Navigation Tabs -->
    <nav class="admin-nav-tabs">
      <button class="admin-tab active" data-tab="dashboard">
        <span class="material-icons">bar_chart</span>
        <span>Dashboard</span>
      </button>
      <button class="admin-tab" data-tab="schedule">
        <span class="material-icons">event</span>
        <span>Schedule</span>
      </button>
      <button class="admin-tab" data-tab="employees">
        <span class="material-icons">group</span>
        <span>Employees</span>
      </button>
      <button class="admin-tab" data-tab="session-swaps">
        <span class="material-icons">swap_horiz</span>
        <span>Session Swaps</span>
        <span class="tab-badge">3</span>
      </button>
    </nav>

    <!-- Welcome Banner -->
    <div class="admin-welcome-banner">
      <div class="admin-welcome-content">
        <h1 class="admin-welcome-greeting">Good afternoon, {{ user.first_name if user else 'Admin' }}! ðŸ‘‹</h1>
        <p class="admin-welcome-role">System Administrator â€¢ Schedule Manager</p>
        <p class="admin-welcome-stats">System-wide: 47 units, 12 coordinators, 125 facilitators across all programs.</p>
      </div>
      <div class="admin-welcome-actions">
        <button class="admin-settings-btn" type="button" aria-label="Settings">
          <span class="material-icons">settings</span>
        </button>
      </div>
    </div>


    <!-- Unit Status Distribution -->
    <div class="unit-status-card">
      <h3 class="unit-status-title">Unit Status Distribution</h3>
      
      <!-- Top Row - Unit Status -->
      <div class="unit-status-row">
        <div class="unit-status-metric">
          <div class="unit-status-value active">{{ active_units_count or 28 }}</div>
          <div class="unit-status-label">Active Units</div>
        </div>
        <div class="unit-status-metric">
          <div class="unit-status-value upcoming">{{ upcoming_units_count or 12 }}</div>
          <div class="unit-status-label">Upcoming Units</div>
        </div>
        <div class="unit-status-metric">
          <div class="unit-status-value completed">{{ completed_units_count or 7 }}</div>
          <div class="unit-status-label">Completed Units</div>
        </div>
      </div>

      <!-- Bottom Row - Session Statistics -->
      <div class="session-stats-row">
        <div class="session-stat-metric">
          <div class="session-stat-value">{{ avg_sessions_per_unit or 8.3 }}</div>
          <div class="session-stat-label">Average Sessions per Unit</div>
        </div>
        <div class="session-stat-metric">
          <div class="session-stat-value">{{ total_sessions_completed or 1847 }}</div>
          <div class="session-stat-label">Total Sessions Completed</div>
        </div>
      </div>
    </div>

    <!-- Facilitator Management Section (Hidden by default) -->
    <div class="facilitator-management" id="facilitatorManagement" style="display: none;">
      <!-- Header -->
      <div class="facilitator-header">
        <div class="facilitator-header-content">
          <h2 class="facilitator-title">Facilitator Management</h2>
          <p class="facilitator-subtitle">Comprehensive facilitator oversight, performance tracking, and workforce management.</p>
        </div>
        <div class="facilitator-header-actions">
          <button class="facilitator-action-btn secondary">
            <span class="material-icons">download</span>
            Export Data
          </button>
          <button class="facilitator-action-btn secondary">
            <span class="material-icons">upload</span>
            Import
          </button>
          <button class="facilitator-action-btn primary">
            <span class="material-icons">person_add</span>
            <span>Add Employee</span>
          </button>
        </div>
      </div>


      <!-- Directory Content (shown directly) -->
      <div class="facilitator-directory-content">
        <!-- Search and Filter Section -->
        <div class="facilitator-search-section">
          <div class="search-bar">
            <span class="material-icons search-icon">search</span>
            <input type="text" id="facilitatorSearch" placeholder="Search employees by name or email..." class="search-input">
          </div>
          <div class="filter-controls">
            <select id="positionFilter" class="filter-select">
              <option value="">All Positions</option>
              <option value="admin">Admin</option>
              <option value="facilitator">Facilitator</option>
              <option value="unit_coordinator">Unit Coordinator</option>
            </select>
            <select id="statusFilter" class="filter-select">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="on_leave">On Leave</option>
            </select>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
          <span id="resultsCount">Showing {{ facilitators|length or 0 }} of {{ facilitators|length or 0 }} facilitators</span>
        </div>

        <!-- Facilitator List -->
        <div class="facilitator-list" id="facilitatorList">
          {% for facilitator in facilitators %}
          <div class="facilitator-card" data-facilitator-id="{{ facilitator.id }}">
            <div class="facilitator-avatar">
              <span class="material-icons">person</span>
            </div>
            <div class="facilitator-info">
              <div class="facilitator-name">{{ facilitator.full_name }}</div>
              <div class="facilitator-badges">
                <span class="badge badge-position">
                  {% if facilitator.preferences %}
                    {% set prefs = facilitator.preferences|from_json %}
                    {{ prefs.get('position', 'facilitator')|replace('_', ' ')|title }}
                  {% else %}
                    Facilitator
                  {% endif %}
                </span>
                <span class="badge badge-status">
                  {% if facilitator.preferences %}
                    {% set prefs = facilitator.preferences|from_json %}
                    {{ prefs.get('status', 'active')|title }}
                  {% else %}
                    Active
                  {% endif %}
                </span>
                {% if facilitator.preferences %}
                  {% set prefs = facilitator.preferences|from_json %}
                  {% if prefs.get('role') and prefs.get('position') == 'facilitator' %}
                    <span class="badge badge-role">
                      {{ prefs.get('role', 'lab_facilitator')|replace('_', ' ')|title }}
                    </span>
                  {% endif %}
                {% endif %}
              </div>
              <div class="facilitator-details">
                <span class="facilitator-email">{{ facilitator.email }}</span>
                <span class="facilitator-phone">
                  {% if facilitator.preferences %}
                    {% set prefs = facilitator.preferences|from_json %}
                    {{ prefs.get('phone', 'No phone set') }}
                  {% else %}
                    No phone set
                  {% endif %}
                </span>
              </div>
              <div class="facilitator-metrics">
                <div class="metric-item">
                  <span class="material-icons">star</span>
                  <span>4.5</span>
                </div>
                <div class="metric-item">
                  <span class="material-icons">schedule</span>
                  <span>0h Hours</span>
                </div>
                <div class="metric-item">
                  <span class="material-icons">folder</span>
                  <span>0 Units</span>
                </div>
              </div>
            </div>
            <div class="facilitator-actions">
              <button class="action-btn edit" title="Edit Profile" onclick="openEditModal({{ facilitator.id }}, '{{ facilitator.full_name }}', '{{ facilitator.email }}')">
                <span class="material-icons">person</span>
              </button>
              <button class="action-btn key" title="Edit Details" onclick="openEditModal({{ facilitator.id }}, '{{ facilitator.full_name }}', '{{ facilitator.email }}')">
                <span class="material-icons">edit</span>
              </button>
              <div class="dropdown-container">
                <button class="action-btn more" title="More Options" onclick="toggleDropdown({{ facilitator.id }})">
                  <span class="material-icons">more_vert</span>
                </button>
                <div class="dropdown-menu" id="dropdown-{{ facilitator.id }}" style="display: none;">
                  <button class="dropdown-item" onclick="disableAccount({{ facilitator.id }}, '{{ facilitator.full_name }}')">
                    <span class="material-icons">person_off</span>
                    Disable Account
                  </button>
                  <button class="dropdown-item delete" onclick="deleteAccount({{ facilitator.id }}, '{{ facilitator.full_name }}')">
                    <span class="material-icons">delete</span>
                    Delete Employee Account
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
          
          {% if not facilitators %}
          <div class="empty-state">
            <span class="material-icons">group</span>
            <h3>No facilitators found</h3>
            <p>Add your first facilitator using the "Add Employee" button above.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

  </main>

  <!-- Add Employee Modal -->
  <div class="modal-overlay" id="addEmployeeModal" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2 class="modal-title">Add New Employee</h2>
        <p class="modal-description">Add a new employee with their contact information and role details.</p>
        <button class="modal-close" id="closeModal">
          <span class="material-icons">close</span>
        </button>
      </div>
      
      <form class="modal-form" id="addEmployeeForm">
        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="fullName" class="form-label">Full Name</label>
              <input type="text" id="fullName" name="fullName" class="form-input" placeholder="Enter full name" required>
            </div>
            
            <div class="form-group">
              <label for="phone" class="form-label">Phone</label>
              <input type="tel" id="phone" name="phone" class="form-input" placeholder="Enter phone number" required>
            </div>
            
            <div class="form-group">
              <label for="position" class="form-label">Position</label>
              <select id="position" name="position" class="form-select">
                <option value="">Select position</option>
                <option value="facilitator">Facilitator</option>
                <option value="unit_coordinator">Unit Coordinator</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="form-group role-group" id="roleGroup" style="display: none;">
              <label for="role" class="form-label">Role</label>
              <select id="role" name="role" class="form-select">
                <option value="lab_facilitator">Lab Facilitator</option>
                <option value="senior_facilitator">Senior Facilitator</option>
                <option value="lead_facilitator">Lead Facilitator</option>
              </select>
            </div>
            
          </div>
          
          <div class="form-column">
            <div class="form-group">
              <label for="email" class="form-label">Email</label>
              <input type="email" id="email" name="email" class="form-input" placeholder="Enter email address" required>
            </div>
            
            
            <div class="form-group">
              <label for="status" class="form-label">Status</label>
              <select id="status" name="status" class="form-select">
                <option value="active" selected>Active</option>
                <option value="inactive">Inactive</option>
                <option value="on_leave">On Leave</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn-primary">Add Employee</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2 class="modal-title">Edit Employee Details</h2>
        <p class="modal-description">Update employee information and manage account settings.</p>
        <button class="modal-close" id="closeEditModal">
          <span class="material-icons">close</span>
        </button>
      </div>
      
      <form class="modal-form" id="editEmployeeForm">
        <input type="hidden" id="editEmployeeId" name="employeeId">
        
        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="editFullName" class="form-label">Full Name</label>
              <input type="text" id="editFullName" name="fullName" class="form-input" placeholder="Enter full name" required>
            </div>
            
            <div class="form-group">
              <label for="editPhone" class="form-label">Phone</label>
              <input type="tel" id="editPhone" name="phone" class="form-input" placeholder="Enter phone number" required>
            </div>
            
            <div class="form-group">
              <label for="editPosition" class="form-label">Position</label>
              <select id="editPosition" name="position" class="form-select">
                <option value="">Select position</option>
                <option value="facilitator">Facilitator</option>
                <option value="unit_coordinator">Unit Coordinator</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="form-group role-group" id="editRoleGroup" style="display: none;">
              <label for="editRole" class="form-label">Role</label>
              <select id="editRole" name="role" class="form-select">
                <option value="lab_facilitator">Lab Facilitator</option>
                <option value="senior_facilitator">Senior Facilitator</option>
                <option value="lead_facilitator">Lead Facilitator</option>
              </select>
            </div>
          </div>
          
          <div class="form-column">
            <div class="form-group">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" id="editEmail" name="email" class="form-input" placeholder="Enter email address" required>
            </div>
            
            <div class="form-group">
              <label for="editStatus" class="form-label">Status</label>
              <select id="editStatus" name="status" class="form-select">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="on_leave">On Leave</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Password Reset Section -->
        <div class="password-reset-section">
          <h3 class="password-reset-title">Password Management</h3>
          <div class="password-reset-options">
            <button type="button" class="btn-secondary" onclick="sendResetLink()">
              <span class="material-icons">email</span>
              Send Reset Link to Employee
            </button>
            <button type="button" class="btn-secondary" onclick="adminResetPassword()">
              <span class="material-icons">lock_reset</span>
              Admin Reset Password
            </button>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancelEditBtn">Cancel</button>
          <button type="submit" class="btn-primary">Update Employee</button>
        </div>
      </form>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/admin.js') }}" defer></script>
</body>
</html>


