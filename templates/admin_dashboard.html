<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schedule Manager</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <style>
    /* User Dropdown Styles */
    .admin-topbar__user-dropdown {
      position: relative;
      display: inline-block;
    }

    .admin-topbar__user {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: #374151;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }

    .admin-topbar__user:hover {
      background-color: #f3f4f6;
    }

    .dropdown-arrow {
      font-size: 18px !important;
      transition: transform 0.2s ease;
    }

    .admin-topbar__user[aria-expanded="true"] .dropdown-arrow {
      transform: rotate(180deg);
    }

    .user-dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      min-width: 280px;
      z-index: 1000;
      border: 1px solid #e5e7eb;
      overflow: hidden;
    }

    .dropdown-header {
      padding: 16px;
      background-color: #f9fafb;
    }

    .dropdown-user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background-color: #e5e7eb;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      font-size: 20px;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      color: #111827;
      font-size: 14px;
    }

    .user-email {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
    }

    .dropdown-divider {
      height: 1px;
      background-color: #e5e7eb;
      margin: 8px 0;
    }

    .dropdown-items {
      padding: 8px 0;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      color: #374151;
      text-decoration: none;
      font-size: 14px;
      transition: background-color 0.2s ease;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
    }

    .dropdown-item:hover {
      background-color: #f3f4f6;
    }

    .dropdown-item .material-icons {
      font-size: 18px;
      color: #6b7280;
    }

    .dropdown-item.logout-item {
      color: #dc2626;
    }

    .dropdown-item.logout-item .material-icons {
      color: #dc2626;
    }

    .dropdown-item.logout-item:hover {
      background-color: #fef2f2;
    }

    .logout-dropdown-form {
      width: 100%;
    }

    /* Profile View Styles */
    .profile-view-container {
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 16px;
    }

    .profile-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 24px;
      color: white;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }

    .profile-info {
      flex: 1;
    }

    .profile-name {
      font-size: 28px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }

    .profile-email {
      font-size: 16px;
      margin: 0 0 8px 0;
      opacity: 0.9;
    }

    .profile-role {
      background-color: rgba(255, 255, 255, 0.2);
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 600;
    }

    .profile-content {
      margin-bottom: 32px;
    }

    .profile-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .profile-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .card-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .card-header .material-icons {
      color: #667eea;
      font-size: 20px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      flex: 1;
    }

    .view-all-link {
      display: flex;
      align-items: center;
      gap: 4px;
      color: #667eea;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
    }

    .view-all-link:hover {
      text-decoration: underline;
    }

    .card-content {
      padding: 24px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .info-item:last-of-type {
      border-bottom: none;
      margin-bottom: 20px;
    }

    .info-label {
      font-weight: 500;
      color: #6b7280;
    }

    .info-value {
      font-weight: 600;
      color: #111827;
    }

    .profile-edit-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s ease;
    }

    .profile-edit-btn:hover {
      transform: translateY(-1px);
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
    }

    .empty-icon {
      font-size: 48px;
      color: #d1d5db;
      margin-bottom: 16px;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      color: #374151;
      margin: 0 0 8px 0;
    }

    .empty-description {
      color: #6b7280;
      margin: 0 0 24px 0;
      line-height: 1.5;
    }

    .create-unit-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s ease;
    }

    .create-unit-btn:hover {
      transform: translateY(-1px);
    }

    .profile-back-section {
      text-align: center;
      padding: 20px 0;
    }

    .back-to-dashboard-btn {
      background: white;
      color: #374151;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .back-to-dashboard-btn:hover {
      background-color: #f9fafb;
      border-color: #9ca3af;
    }

    @media (max-width: 768px) {
      .profile-cards {
        grid-template-columns: 1fr;
      }
      
      .profile-header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <header class="admin-topbar">
    <div class="admin-topbar__container">
      <div class="admin-topbar__left">
        <span class="material-icons admin-topbar__logo" aria-hidden="true">event</span>
        <span class="admin-topbar__title">Schedule Manager</span>
      </div>
      <div class="admin-topbar__right">
        <a href="{{ url_for('unitcoordinator.admin_dashboard') }}" class="admin-topbar-portal-btn" title="Unit Coordinator Portal">
          <span class="material-icons">school</span>
          <span>Unit Coordinator Portal</span>
        </a>
        <div class="notification-container">
          <button class="icon-btn notification-btn" type="button" aria-label="Notifications" id="adminNotifBtn">
            <span class="material-icons" aria-hidden="true">notifications</span>
          </button>
          {% if pending_swaps and pending_swaps > 0 %}
            <span class="notification-badge" aria-label="{{ pending_swaps }} unread notifications">
              {{ pending_swaps }}
            </span>
          {% else %}
            <span class="notification-badge" aria-label="1 unread notification">1</span>
          {% endif %}
        </div>
        <div class="admin-topbar__user-dropdown" aria-label="Current user">
          <button class="admin-topbar__user" id="userDropdownBtn" type="button" aria-expanded="false">
            <span class="material-icons" aria-hidden="true">person</span>
            <span class="admin-topbar__name">{{ user.full_name if user else 'Admin User' }}</span>
            <span class="material-icons dropdown-arrow" aria-hidden="true">keyboard_arrow_down</span>
          </button>
          <div class="user-dropdown-menu" id="userDropdownMenu" style="display: none;">
            <div class="dropdown-header">
              <div class="dropdown-user-info">
                <span class="material-icons user-avatar">person</span>
                <div class="user-details">
                  <div class="user-name">{{ user.full_name if user else 'Admin User' }}</div>
                  <div class="user-email">{{ user.email if user else 'admin_demo@example.com' }}</div>
                </div>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-items">
              <a href="#" class="dropdown-item" onclick="showProfileView()">
                <span class="material-icons">person</span>
                <span>View Profile</span>
              </a>
              <a href="#" class="dropdown-item">
                <span class="material-icons">settings</span>
                <span>Account Settings</span>
              </a>
              <a href="#" class="dropdown-item">
                <span class="material-icons">tune</span>
                <span>Preferences</span>
              </a>
              <a href="#" class="dropdown-item">
                <span class="material-icons">notifications</span>
                <span>Notifications</span>
              </a>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-items">
              <a href="#" class="dropdown-item">
                <span class="material-icons">help_outline</span>
                <span>Help & Support</span>
              </a>
              <a href="#" class="dropdown-item">
                <span class="material-icons">info_outline</span>
                <span>About</span>
              </a>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-items">
              <form method="POST" action="{{ url_for('auth.logout') }}" class="logout-dropdown-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="dropdown-item logout-item">
                  <span class="material-icons">logout</span>
                  <span>Sign Out</span>
                </button>
              </form>
            </div>
          </div>
        </div>
        <span class="role-chip role-chip--admin">System Admin</span>
        <form method="POST" action="{{ url_for('auth.logout') }}" class="logout-form" style="display: inline;">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <button type="submit" class="logout-btn">
            <span class="material-icons" aria-hidden="true">logout</span>
            <span>Logout</span>
          </button>
        </form>
      </div>
    </div>
  </header>

  <!-- You can add admin content below -->
  <main class="container" style="max-width:1200px;margin:24px auto;padding:0 16px;">
    <h2 style="font-family: 'Roboto', sans-serif; font-weight: 600;">Admin Dashboard</h2>
    
    <!-- Navigation Tabs -->
    <nav class="admin-nav-tabs">
      <button class="admin-tab {% if tab == 'dashboard' %}active{% endif %}" data-tab="dashboard">
        <span class="material-icons">bar_chart</span>
        <span>Dashboard</span>
      </button>
      <button class="admin-tab {% if tab == 'employees' %}active{% endif %}" data-tab="employees">
        <span class="material-icons">group</span>
        <span>Users</span>
      </button>
    </nav>

    <!-- Welcome Banner -->
    <div class="admin-welcome-banner" {% if tab == 'employees' %}style="display: none;"{% endif %}>
      <div class="admin-welcome-content">
        <h1 class="admin-welcome-greeting">Good afternoon, {{ user.first_name if user else 'Admin' }}! 👋</h1>
        <p class="admin-welcome-role">System Administrator • Schedule Manager</p>
        <p class="admin-welcome-stats">System-wide: 47 units, 12 coordinators, 125 facilitators across all programs.</p>
      </div>
      <div class="admin-welcome-actions">
        <button class="admin-settings-btn" type="button" aria-label="Settings">
          <span class="material-icons">settings</span>
        </button>
      </div>
    </div>


    <!-- Unit Status Distribution -->
    <div class="unit-status-card" {% if tab == 'employees' %}style="display: none;"{% endif %}>
      <h3 class="unit-status-title">Unit Status Distribution</h3>
      
      <!-- Top Row - Unit Status -->
      <div class="unit-status-row">
        <div class="unit-status-metric">
          <div class="unit-status-value active">{{ active_units_count }}</div>
          <div class="unit-status-label">Active Units</div>
        </div>
        <div class="unit-status-metric">
          <div class="unit-status-value upcoming">{{ upcoming_units_count }}</div>
          <div class="unit-status-label">Upcoming Units</div>
        </div>
        <div class="unit-status-metric">
          <div class="unit-status-value completed">{{ completed_units_count }}</div>
          <div class="unit-status-label">Completed Units</div>
        </div>
      </div>

      <!-- Bottom Row - Session Statistics -->
      <div class="session-stats-row">
        <div class="session-stat-metric">
          <div class="session-stat-value">{{ avg_sessions_per_unit }}</div>
          <div class="session-stat-label">Average Sessions per Unit</div>
        </div>
        <div class="session-stat-metric">
          <div class="session-stat-value">{{ total_sessions_completed }}</div>
          <div class="session-stat-label">Total Sessions Completed</div>
        </div>
      </div>
    </div>

    <!-- Facilitator Management Section (Hidden by default) -->
    <div class="facilitator-management" id="facilitatorManagement" {% if tab == 'employees' %}style="display: block;"{% else %}style="display: none;"{% endif %}>
      <!-- Header -->
      <div class="facilitator-header">
        <div class="facilitator-header-content">
          <h2 class="facilitator-title">User Management</h2>
          <p class="facilitator-subtitle">Comprehensive user oversight, performance tracking, and workforce management.</p>
        </div>
        <div class="facilitator-header-actions">
          <button class="facilitator-action-btn secondary">
            <span class="material-icons">download</span>
            Export Data
          </button>
          <button class="facilitator-action-btn secondary">
            <span class="material-icons">upload</span>
            Import
          </button>
          <button class="facilitator-action-btn primary">
            <span class="material-icons">person_add</span>
            <span>Add User</span>
          </button>
        </div>
      </div>


      <!-- Directory Content (shown directly) -->
      <div class="facilitator-directory-content">
        <!-- Search and Filter Section -->
        <div class="facilitator-search-section">
          <div class="search-bar">
            <span class="material-icons search-icon">search</span>
            <input type="text" id="facilitatorSearch" placeholder="Search users by name or email..." class="search-input">
          </div>
          <div class="filter-controls">
            <select id="positionFilter" class="filter-select">
              <option value="">All Positions</option>
              <option value="admin">Admin</option>
              <option value="facilitator">Facilitator</option>
              <option value="unit_coordinator">Unit Coordinator</option>
            </select>
            <select id="statusFilter" class="filter-select">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="on_leave">On Leave</option>
            </select>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
          <span id="resultsCount">Showing {{ facilitators|length or 0 }} of {{ facilitators|length or 0 }} users</span>
        </div>

        <!-- Facilitator List -->
        <div class="facilitator-list" id="facilitatorList">
          {% for facilitator in facilitators %}
          <div class="facilitator-card" data-facilitator-id="{{ facilitator.id }}">
            <div class="facilitator-avatar">
              <span class="material-icons">person</span>
            </div>
            <div class="facilitator-info">
              <div class="facilitator-name">{{ facilitator.full_name }}</div>
              <div class="facilitator-badges">
                <span class="badge badge-position">
                  {% if facilitator.preferences %}
                    {% set prefs = facilitator.preferences|from_json %}
                    {{ prefs.get('position', 'facilitator')|replace('_', ' ')|title }}
                  {% else %}
                    Facilitator
                  {% endif %}
                </span>
                <span class="badge badge-status">
                  {% if facilitator.preferences %}
                    {% set prefs = facilitator.preferences|from_json %}
                    {{ prefs.get('status', 'active')|replace('_', ' ')|title }}
                  {% else %}
                    Active
                  {% endif %}
                </span>
                {% if facilitator.preferences %}
                  {% set prefs = facilitator.preferences|from_json %}
                  {% if prefs.get('role') and prefs.get('position') == 'facilitator' %}
                    <span class="badge badge-role">
                      {{ prefs.get('role', 'lab_facilitator')|replace('_', ' ')|title }}
                    </span>
                  {% endif %}
                {% endif %}
              </div>
              <div class="facilitator-details">
                <span class="facilitator-email">{{ facilitator.email }}</span>
                <span class="facilitator-phone">
                  {% if facilitator.preferences %}
                    {% set prefs = facilitator.preferences|from_json %}
                    {{ prefs.get('phone', 'No phone set') }}
                  {% else %}
                    No phone set
                  {% endif %}
                </span>
              </div>
              <div class="facilitator-metrics">
                <div class="metric-item">
                  <span class="material-icons">star</span>
                  <span>4.5</span>
                </div>
                <div class="metric-item">
                  <span class="material-icons">schedule</span>
                  <span>0h Hours</span>
                </div>
                <div class="metric-item">
                  <span class="material-icons">folder</span>
                  <span>0 Units</span>
                </div>
              </div>
            </div>
            <div class="facilitator-actions">
              <button class="action-btn edit" title="Edit Profile" onclick="openEditModal({{ facilitator.id }}, '{{ facilitator.full_name|replace("'", "\\'") }}', '{{ facilitator.email|replace("'", "\\'") }}')">
                <span class="material-icons">person</span>
              </button>
              <button class="action-btn key" title="Edit Details" onclick="openEditModal({{ facilitator.id }}, '{{ facilitator.full_name|replace("'", "\\'") }}', '{{ facilitator.email|replace("'", "\\'") }}')">
                <span class="material-icons">edit</span>
              </button>
              <div class="dropdown-container">
                <button class="action-btn more" title="More Options" onclick="toggleDropdown({{ facilitator.id }})">
                  <span class="material-icons">more_vert</span>
                </button>
                <div class="dropdown-menu" id="dropdown-{{ facilitator.id }}" style="display: none;">
                  <button class="dropdown-item" onclick="disableAccount({{ facilitator.id }}, '{{ facilitator.full_name|replace("'", "\\'") }}')">
                    <span class="material-icons">person_off</span>
                    Disable Account
                  </button>
                  {% if facilitator.role.value == 'admin' and admin_count <= 1 %}
                    <button class="dropdown-item delete disabled" disabled title="Cannot delete the last admin account">
                      <span class="material-icons">delete</span>
                      Delete Employee Account
                    </button>
                  {% else %}
                    <button class="dropdown-item delete" onclick="deleteAccount({{ facilitator.id }}, '{{ facilitator.full_name|replace("'", "\\'") }}')">
                      <span class="material-icons">delete</span>
                      Delete Employee Account
                    </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>   <!-- ✅ close each facilitator-card here -->
          {% endfor %}
          
          {% if not facilitators %}
          <div class="empty-state">
            <span class="material-icons">group</span>
            <h3>No users found</h3>
            <p>Add your first user using the "Add User" button above.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

  </main>

  <!-- Profile View Section -->
  <div class="profile-view-container" id="profileView" style="display: none;">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar">
        <span class="material-icons">person</span>
      </div>
      <div class="profile-info">
        <h1 class="profile-name">{{ user.full_name if user else 'Admin User' }}</h1>
        <p class="profile-email">{{ user.email if user else 'admin_demo@example.com' }}</p>
        <span class="profile-role">System Administrator</span>
      </div>
    </div>

    <!-- Profile Content -->
    <div class="profile-content">
      <div class="profile-cards">
        <!-- Profile Information Card -->
        <div class="profile-card">
          <div class="card-header">
            <span class="material-icons">person</span>
            <h2 class="card-title">Profile Information</h2>
          </div>
          <div class="card-content">
            <div class="info-item">
              <label class="info-label">Full Name</label>
              <span class="info-value">{{ user.full_name if user else 'Admin User' }}</span>
            </div>
            <div class="info-item">
              <label class="info-label">Email Address</label>
              <span class="info-value">{{ user.email if user else 'admin_demo@example.com' }}</span>
            </div>
              <div class="info-item">
                <label class="info-label">Role</label>
                <span class="info-value">System Administrator</span>
              </div>
            <div class="info-item">
              <label class="info-label">Member Since</label>
              <span class="info-value">N/A</span>
            </div>
            <button class="profile-edit-btn" onclick="showEditProfile()">
              <span class="material-icons">edit</span>
              <span>Edit Profile</span>
            </button>
          </div>
        </div>

        <!-- My Units Card -->
        <div class="profile-card">
          <div class="card-header">
            <span class="material-icons">school</span>
            <h2 class="card-title">My Units</h2>
            <a href="#" class="view-all-link">
              <span>View All</span>
              <span class="material-icons">arrow_forward</span>
            </a>
          </div>
          <div class="card-content">
            <div class="empty-state">
              <span class="material-icons empty-icon">school</span>
              <h3 class="empty-title">No Units Yet</h3>
              <p class="empty-description">Create your first unit to get started with session management.</p>
              <button class="create-unit-btn" onclick="createUnit()">
                <span class="material-icons">add</span>
                <span>Create Unit</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Back Button -->
    <div class="profile-back-section">
      <button class="back-to-dashboard-btn" onclick="showDashboardView()">
        <span class="material-icons">arrow_back</span>
        <span>Back to Dashboard</span>
      </button>
    </div>
  </div>

  <!-- Add Employee Modal -->
  <div class="modal-overlay" id="addEmployeeModal" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2 class="modal-title">Add New User</h2>
        <p class="modal-description">Add a new user with their contact information and role details.</p>
        <button class="modal-close" id="closeModal">
          <span class="material-icons">close</span>
        </button>
      </div>
      
      <form class="modal-form" id="addEmployeeForm">
        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="fullName" class="form-label">Full Name</label>
              <input type="text" id="fullName" name="fullName" class="form-input" placeholder="Enter full name" required>
            </div>
            
            <div class="form-group">
              <label for="phone" class="form-label">Phone</label>
              <input type="tel" id="phone" name="phone" class="form-input" placeholder="Enter phone number" required>
            </div>
            
            <div class="form-group">
              <label for="position" class="form-label">Position</label>
              <select id="position" name="position" class="form-select">
                <option value="">Select position</option>
                <option value="facilitator">Facilitator</option>
                <option value="unit_coordinator">Unit Coordinator</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="form-group role-group" id="roleGroup" style="display: none;">
              <label for="role" class="form-label">Role</label>
              <select id="role" name="role" class="form-select">
                <option value="lab_facilitator">Lab Facilitator</option>
                <option value="senior_facilitator">Senior Facilitator</option>
                <option value="lead_facilitator">Lead Facilitator</option>
              </select>
            </div>
            
          </div>
          
          <div class="form-column">
            <div class="form-group">
              <label for="email" class="form-label">Email</label>
              <input type="email" id="email" name="email" class="form-input" placeholder="Enter email address" required>
            </div>
            
            
            <div class="form-group">
              <label for="status" class="form-label">Status</label>
              <select id="status" name="status" class="form-select">
                <option value="active" selected>Active</option>
                <option value="inactive">Inactive</option>
                <option value="on_leave">On Leave</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn-primary">Add User</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2 class="modal-title">Edit User Details</h2>
        <p class="modal-description">Update user information and manage account settings.</p>
        <button class="modal-close" id="closeEditModal">
          <span class="material-icons">close</span>
        </button>
      </div>
      
      <form class="modal-form" id="editEmployeeForm">
        <input type="hidden" id="editEmployeeId" name="employeeId">
        
        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="editFullName" class="form-label">Full Name</label>
              <input type="text" id="editFullName" name="fullName" class="form-input" placeholder="Enter full name" required>
            </div>
            
            <div class="form-group">
              <label for="editPhone" class="form-label">Phone</label>
              <input type="tel" id="editPhone" name="phone" class="form-input" placeholder="Enter phone number" required>
            </div>
            
            <div class="form-group">
              <label for="editPosition" class="form-label">Position</label>
              <select id="editPosition" name="position" class="form-select">
                <option value="">Select position</option>
                <option value="facilitator">Facilitator</option>
                <option value="unit_coordinator">Unit Coordinator</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="form-group role-group" id="editRoleGroup" style="display: none;">
              <label for="editRole" class="form-label">Role</label>
              <select id="editRole" name="role" class="form-select">
                <option value="lab_facilitator">Lab Facilitator</option>
                <option value="senior_facilitator">Senior Facilitator</option>
                <option value="lead_facilitator">Lead Facilitator</option>
              </select>
            </div>
          </div>
          
          <div class="form-column">
            <div class="form-group">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" id="editEmail" name="email" class="form-input" placeholder="Enter email address" required>
            </div>
            
            <div class="form-group">
              <label for="editStatus" class="form-label">Status</label>
              <select id="editStatus" name="status" class="form-select">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="on_leave">On Leave</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Password Reset Section -->
        <div class="password-reset-section">
          <h3 class="password-reset-title">Password Management</h3>
          <div class="password-reset-options">
            <button type="button" class="btn-secondary" onclick="sendResetLink()">
              <span class="material-icons">email</span>
              Send Reset Link to User
            </button>
            <button type="button" class="btn-secondary" onclick="adminResetPassword()">
              <span class="material-icons">lock_reset</span>
              Admin Reset Password
            </button>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancelEditBtn">Cancel</button>
          <button type="submit" class="btn-primary">Update User</button>
        </div>
      </form>
    </div>
  </div>


  <script src="{{ url_for('static', filename='js/admin.js') }}" defer></script>
  <script>
    // User Dropdown Functionality
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownBtn = document.getElementById('userDropdownBtn');
      const dropdownMenu = document.getElementById('userDropdownMenu');
      const arrow = dropdownBtn.querySelector('.dropdown-arrow');

      // Toggle dropdown
      dropdownBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const isOpen = dropdownMenu.style.display === 'block';
        
        if (isOpen) {
          dropdownMenu.style.display = 'none';
          dropdownBtn.setAttribute('aria-expanded', 'false');
        } else {
          dropdownMenu.style.display = 'block';
          dropdownBtn.setAttribute('aria-expanded', 'true');
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.style.display = 'none';
          dropdownBtn.setAttribute('aria-expanded', 'false');
        }
      });

      // Close dropdown when pressing Escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          dropdownMenu.style.display = 'none';
          dropdownBtn.setAttribute('aria-expanded', 'false');
        }
      });

      // Handle dropdown item clicks
      const dropdownItems = dropdownMenu.querySelectorAll('.dropdown-item');
      dropdownItems.forEach(item => {
        item.addEventListener('click', function(e) {
          // Close dropdown after clicking an item (except logout)
          if (!this.classList.contains('logout-item')) {
            e.preventDefault();
            dropdownMenu.style.display = 'none';
            dropdownBtn.setAttribute('aria-expanded', 'false');
            
            // You can add specific functionality for each item here
            const text = this.querySelector('span:last-child').textContent;
            console.log('Clicked:', text);
          }
        });
      });
    });

    // Profile View Functions
    function showProfileView() {
      // Hide main dashboard content
      const mainContent = document.querySelector('.container');
      if (mainContent) {
        mainContent.style.display = 'none';
      }
      
      // Show profile view
      const profileView = document.getElementById('profileView');
      if (profileView) {
        profileView.style.display = 'block';
      }
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function showDashboardView() {
      // Show main dashboard content
      const mainContent = document.querySelector('.container');
      if (mainContent) {
        mainContent.style.display = 'block';
      }
      
      // Hide profile view
      const profileView = document.getElementById('profileView');
      if (profileView) {
        profileView.style.display = 'none';
      }
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function showEditProfile() {
      // You can implement edit profile functionality here
      alert('Edit Profile functionality would be implemented here');
    }

    function createUnit() {
      // You can implement create unit functionality here
      alert('Create Unit functionality would be implemented here');
    }
  </script>
</body>
</html>


